<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Jack Leitch RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Jack Leitch Atom Feed">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><title data-rh="true">Predicting Strava Kudos | Jack Leitch</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://jackmleitch.github.io/blog/Strava-Kudos"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Predicting Strava Kudos | Jack Leitch"><meta data-rh="true" name="description" content="An end-to-end data science project, from data collection to model deployment, aimed at predicting user interaction on Strava activities based on the given activity’s attributes."><meta data-rh="true" property="og:description" content="An end-to-end data science project, from data collection to model deployment, aimed at predicting user interaction on Strava activities based on the given activity’s attributes."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2021-10-25T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/jackmleitch"><meta data-rh="true" property="article:tag" content="Python,Regression,Scikit-Learn,Optuna,XGBoost"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://jackmleitch.github.io/blog/Strava-Kudos"><link data-rh="true" rel="alternate" href="https://jackmleitch.github.io/blog/Strava-Kudos" hreflang="en"><link data-rh="true" rel="alternate" href="https://jackmleitch.github.io/blog/Strava-Kudos" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.bb947118.css">
<link rel="preload" href="/assets/js/runtime~main.e098bd35.js" as="script">
<link rel="preload" href="/assets/js/main.8cf1aa75.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/favicon.ico" alt="Machine Learning Engineer" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/favicon.ico" alt="Machine Learning Engineer" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Jack Leitch</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/docs/experience">Experience</a><a class="navbar__item navbar__link" href="/docs/projects">Projects</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/jackmleitch" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/Essay-Companion">Building NLP Powered Applications with Hugging Face Transformers</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/Churn-Prediction">Building Interpretable Models on Imbalanced Data</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/Strava-Kudos">Predicting Strava Kudos</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/Recipe-Recommendation">Building a Recipe Recommendation System</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/Strava-AP">Automating Mundane Web-Based Tasks With Selenium and Heroku</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/Project-Auto">Automating the Setup of my Data Science Projects</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/Recipe-Recommendation2">Building a Recipe Recommendation API using Scikit-Learn, NLTK, Docker, Flask, and Heroku</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/OrganizingML">Organizing Machine Learning Projects</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/Gradient-Descent">The ins and outs of Gradient Descent</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/Recipe-Recommendation1">Using BeautifulSoup to Help Make Beautiful Soups</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_Ikge" itemprop="headline">Predicting Strava Kudos</h1><div class="blogPostData_SAv4 margin-vert--md"><time datetime="2021-10-25T00:00:00.000Z" itemprop="datePublished">October 25, 2021</time> · <!-- -->21 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_sTYa"><div class="avatar margin-bottom--sm"><a href="https://github.com/jackmleitch" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/jackmleitch.png" alt="Jack Leitch"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/jackmleitch" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jack Leitch</span></a></div><small class="avatar__subtitle" itemprop="description">Machine Learning Engineer</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><p><strong>An end-to-end data science project, from data collection to model deployment, aimed at predicting user interaction on Strava activities based on the given activity’s attributes.</strong></p><p>Strava is a service for tracking human exercise which incorporates social network type features. It is mostly used for cycling and running, with an emphasis on using GPS data. A typical Strava post from myself is shown below and we can see that it contains a lot of information: distance, moving time, pace, elevation, weather, GPS route, who I ran with, etc., etc.</p><p><img loading="lazy" alt="alt" src="/assets/images/strava1-fdfa013a2c6b3f4732bc99c62f823a3b.png" width="1032" height="1246" class="img_ev3q"></p><p>Now, Strava is also a social media and each activity can be given kudos, which is the equivalent of likes on other platforms. So given that I’ve posted over 4000 activities on Strava, it was a great place to start a unique little data science project. My goal was to predict the number of kudos each activity gets based on the activity&#x27;s attributes.</p><p>Predicting Kudos wasn&#x27;t necessarily an easy task, however. Of the data points extracted from Strava, the mean Kudos count was 38 with a standard deviation of 24. The minimum was 0 and the maximum was 171. There is a lot of variability in the data… so hopefully we can create some useful features to help explain this!</p><p><img loading="lazy" alt="kudos" src="data:image/png;base64,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4MCB4XA4JyensLBQ7gCQNNrlDJiHDx+ORCJf/vKXS0tLx4wZc80110Sj0cRDGRkZJSUlcgcAZaIptbW1O3fufPrpp3v16vXVr361Z8+eDR8NhULNLqF//97ttMHNXg6jJSKRcIfN0yYr3FYL7Iob3uhznTexzUPuElJzqyUgBCG0RwjtUib+7M/+bOTIkf369QuC4Oabby4sLOzevXvioePHj2dkZDS7hLKyirq6eHuEVVp6uvULaXjNyYtpq3lav8JtlUBX3PBG1/m8q4a2echd5YMjBbdaAkIQQutDaLR2NPWdicWLFze8O2/evBY+05gxY15//fXy8vLa2trXXntt/PjxBw8ePHz4cG1t7ebNmzMzM3VAAEgaje+ZWLJkSUlJSXFx8cmTJxNTYrHYgQMHWrjQoUOH/v3f//0dd9xRU1MzevToGTNmfPKTn5w3b15VVVVWVtb48ePlDgBJXiamT5++f//+ffv2jRs3LjGle/fuw4cPb/lyp3+g/u7IkSNffPFFcQNAqpSJ6z4watSoK6+8UkYAwIcuEwlvv/12Xl7eqVOn4vH/+13ITZs2iQwAaGmZWLp06bRp04YMGdKSH3MCAMrE+SKRyF133SUjAKAJTf009Jprrtm3b5+MAIAmNLVn4siRI9OmTfvYxz6Wnp6emOI7EwDAhygTCxYsEBCdVt8reqanheUA0KnLxLXXXisgOq30tHDe481czn7l/CxBAVzOMjFixIhQKBSPxxO/5ohGo9u2bRMZANDSMvHWW28lbtTU1Lz88sv1dwEA6nVryUyRSGTixIlvvPGGvACA8zS1Z+L9999P3IjH47t37y4vL5cXAPAhykT9dyaCIOjfv/8DDzwgLwDgQ5QJX5IAAFpVJurq6p566qlt27bFYrHRo0fPmTMnHPazflJOS05oUVUdKz91VlaAMnG+73znO2+99dadd95ZV1f37LPPrlixYvHixSIj1TihBcCll4nXXnvt+eefj0QiQRD89V//9a233qpMAAAfokzE4/FEkwiCIC0trf42XU7DHfXRaJ9G57GjHoC2LxODBw9etmzZF7/4xSAInnnmGWfX7rrqd9RHIuGamlij89hRD8ClaeqkVUuWLCkvL8/Nzb399tvfe++9Bx98UF4AQIvKRHV19cKFC998883ly5cXFRV95jOf6d69e+/eveUFALSoTKxZ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x0bSe+edd+o/FoIg6Nev3yWPBBf6AgBaxRkwAQBlAgBQJgAAZQIAUCYAAJQJAECZADrIL3/5yw91nomlS5d+97vf7Tzrv2vXrm984xteR1AmAC7R7373u5S6WhsoE0DntXPnzjFjxvzgBz+o31FRv9OioqJi/vz548aNmzlz5oEDBxKP7t+/f+bMmTk5ObfeemtBQUHikoP33XffbbfdNmXKlPz8/Itd2byysnLRokXjxo2bMGHCY489Fo/HT58+/bWvfW3SpEk5OTkrVqyIxWJBEPzFX/zFyZMnE/8kcfuXv/xlbm5uXl7e5MmTJ0yY8Oabbx47dmzNmjU7d+5ctGiRVxCUCeByevPNNxctWvT9739/+PDhFz66Zs2aHj16FBYWPv744wcPHgyCIBaLfeUrX5k5c+amTZuefPLJxx577De/+c0rr7xSWVn505/+NHGtoCNHjjT6XGvWrKmqqtqyZUtBQcGvf/3rHTt2PPzwwx/5yEc2bdr0/PPP79u3L3Ga50bt2rVr9uzZBQUF06dPf+KJJz760Y/ed999N9xww6OPPupFBGUCuGz+8Ic/zJkz52/+5m8GDx7c6Azbt2+fPHlyKBTq169f4to/hw4dqqqqys7OTlz7Jjs7+7XXXrv++ut/97vfzZw585//+Z/vvPPOQYMGNbq0oqKi6dOnd+/ePS0t7Zlnnrnxxhu3bdv2xS9+MRQKpaWl5ebmbtu27WKr+rGPfezTn/50EARDhgw5deqU1w6UCaBT6N69+49+9KONGzfu2rUrFPr/1+upqampn6d+Yvfu3YMgOO8QRjwej8ViAwcOfOWVV+6+++6Kioq77rqrsLCw0acLh8OhUChx+9ixY++9917DpdXV1SUOc9Srrq6uv92jR4/EjYbrCSgTwGUWjUY/+9nPLly4MC8vr1+/fkePHi0rK4vH4z/72c8SM3z+85/fsGFDXV3dqVOnfv7znwdBcPXVV0cikZdffjkIgpKSkpdeemnUqFH/9m//tmjRoptuuikvL++mm27av39/o083cuTIjRs31tXVVVdX33fffb/61a9uuummdevWxePx6urq9evXjxo1KnEBw//6r/8KguCVV15pugmdVz4AZQK4PKZMmXL11Vc//fTTubm506ZNu/3226PRaOKhefPmhcPhW265Zc6cOddee20QBJFIZO3atf/6r/+ak5Nz1113zZ07d8SIEZMnT66trZ0wYcLUqVMrKioudjnve++9NxKJ3HbbbZMnT87KysrOzs7Pzz958mTOB66++uo5c+YEQZCfn7906dIpU6bs2bOnfk0uNHz48AMHDsydO9crCJeRXYUAQKuERQC0hwMHDixYsOC8iVdfffU//dM/CQeSjD0TAECr+M4EAKBMAADKBACgTAAAygQAwIf0fwIAAP//AdSz+8N13YcAAAAASUVORK5CYII=" width="708" height="348" class="img_ev3q"></p><p>If you want to fast forward to the end project, you can find the finished product <a href="http://strava-kudos.herokuapp.com/" target="_blank" rel="noopener noreferrer">here</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="data-collection">Data Collection<a class="hash-link" href="#data-collection" title="Direct link to heading">​</a></h2><p>Strava has a feature that allows the user to download all of their previous data, however, this can only be done once a week. A much better solution for data collection was to use the Strava API which allows you to make 100 requests every 15 minutes, and a total of 1000 daily i.e. more than enough calls for our intended goal.</p><p>Using this <a href="https://developers.strava.com/docs/reference/" target="_blank" rel="noopener noreferrer">API</a>, I was able to efficiently gather all my activity data very quickly. Lovely. Another benefit of this API was that it allowed me to extract my most recent activities so that I could predict kudos on the fly, which was one of the end goals for this project. A GIF of this real-time Kudos prediction on my Streamlit app can be seen below.</p><p><img loading="lazy" alt="gif" src="/assets/images/streamlit-44fabf87fc9b178e667c735881e01516.gif" width="600" height="282" class="img_ev3q"></p><p>If you&#x27;re interested in getting started with the Strava API, I would highly recommend that you start with <a href="https://medium.com/r?url=https%3A%2F%2Ftowardsdatascience.com%2Fusing-the-strava-api-and-pandas-to-explore-your-activity-data-d94901d9bfde" target="_blank" rel="noopener noreferrer">this blog post</a>.</p><p>Once I had set things up and had the required keys, getting recent activities was easy!</p><div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">/src/strava_api.py</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">load_recent_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">recent</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># get payload information</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auth_url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://www.strava.com/oauth/token&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    activites_url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://www.strava.com/api/v3/athlete/activities&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    payload </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;client_id&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;XXXX&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;client_secret&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;XXXX&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;refresh_token&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;XXXX&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;grant_type&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;refresh_token&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;f&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;json&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># check if there is a new request token</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    res </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">auth_url</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">payload</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> verify</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    access_token </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;access_token&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;Authorization&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Bearer &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> access_token</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># initialise dataframe with first few activities</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    param </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;per_page&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> recent</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;page&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    my_dataset </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">activites_url</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> headers</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">header</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> params</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">param</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    activities </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">json_normalize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">my_dataset</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># keep useful features</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    columns_to_keep </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;name&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;kudos_count&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;distance&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;moving_time&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    activities </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> activities</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">columns_to_keep</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> activities</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>By simply adding a while loop to this code, it was easy to get all the Strava data I needed for my project!</p><table><thead><tr><th>name</th><th>distance</th><th>moving_time</th><th>total_elevation_gain</th><th>workout_type</th><th>kudos_count</th><th>max_speed</th><th>average_heartrate</th><th>max_heartrate</th><th>pr_count</th><th>suffer_score</th><th>is_named</th><th>local_date</th><th>run_per_day</th><th>max_run</th><th>run_area</th><th>average_speed_mpk</th><th>datetime</th><th>hour</th><th>uk_awake</th></tr></thead><tbody><tr><td>Plastic bag floating in the wind</td><td>16.1041</td><td>75.0</td><td>181.2</td><td>0.0</td><td>45</td><td>5.4</td><td>144.0</td><td>165.0</td><td>0</td><td>33.0</td><td>1</td><td>2021-09-09</td><td>1</td><td>1</td><td>12.377207167446613</td><td>4.656607991058955</td><td>2021-09-09 13:57:28</td><td>13</td><td>1</td></tr><tr><td>Cake loop 🎂</td><td>21.0416</td><td>99.05</td><td>346.9</td><td>0.0</td><td>54</td><td>5.0</td><td>151.0</td><td>167.0</td><td>1</td><td>83.0</td><td>1</td><td>2021-09-08</td><td>1</td><td>1</td><td>84.87930754199624</td><td>4.706580062129342</td><td>2021-09-08 13:43:26</td><td>13</td><td>1</td></tr><tr><td>Doublé</td><td>8.0736</td><td>38.78333333333333</td><td>92.0</td><td>0.0</td><td>30</td><td>4.4</td><td>137.7</td><td>161.0</td><td>0</td><td>12.0</td><td>1</td><td>2021-09-07</td><td>2</td><td>0</td><td>4.8462999984622</td><td>4.802881844380403</td><td>2021-09-07 20:07:54</td><td>20</td><td>0</td></tr><tr><td>Moderate beanage🐘</td><td>19.607200000000002</td><td>87.51666666666667</td><td>23.0</td><td>3.0</td><td>52</td><td>7.3</td><td>142.9</td><td>191.0</td><td>0</td><td>44.0</td><td>1</td><td>2021-09-07</td><td>2</td><td>1</td><td>6.491399835795164</td><td>4.463310123192287</td><td>2021-09-07 13:12:26</td><td>13</td><td>1</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="exploratory-data-analysis-eda">Exploratory Data Analysis (EDA)<a class="hash-link" href="#exploratory-data-analysis-eda" title="Direct link to heading">​</a></h2><p>Once I had all the data, the next thing on the agenda was some EDA. This involved exploring the data, looking at distributions, correlations, and general information about different features. The notebook I created for this can be found on <a href="https://github.com/jackmleitch/StravaKudos" target="_blank" rel="noopener noreferrer">my Github page</a>.</p><p>Some notable findings include:</p><ul><li>The Kudos received depends heavily on how many followers I had at the time. Unfortunately, there was no way to see how many followers I had at each point in time so I was unable to weight the Kudos with respect to follower count. I therefore could only use my most recent 1125 activities (from Dec 2019 to present) to train my model as the kudos stayed fairly consistent in this interval.</li></ul><p><img loading="lazy" alt="kudos_time" src="/assets/images/kudos_time-72495e01f665abd3f5efc38e511a819d.png" width="388" height="262" class="img_ev3q"></p><ul><li><p>It was found that the target variable (Kudos) is skewed right (also bimodal) and there are some extreme values above ~100. When using certain models, for example, linear regression, would like to see more of a normal distribution in the target variable. A BoxCox transform could therefore be used to see a more ‘normal-looking’ distribution in the target variable (normality can then be checked by plotting a q-q plot, for example).</p></li><li><p>An <a href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.IsolationForest.html" target="_blank" rel="noopener noreferrer">isolation forest model</a> was used to detect outliers and out of the 800 training points, 17 outliers were found. Upon further investigation, these were predominantly activity uploads that were initially set to private but then switched to public at a later date. This meant that other users couldn&#x27;t see or interact with the activity. These were removed from the training set.</p></li><li><p>Features such as distance, moving_time, and average_speed_mpk seem to share a similar distribution to the one we have with kudos_count. This was confirmed when looking at a correlation matrix.</p></li><li><p>The photo count feature only has a few different data points in each nonzero category so we can change this to a binary feature of contains photos/no photos.</p></li><li><p>Workout type seems to correlate strongly with Kudos, however, there aren&#x27;t that many data points for workout type 1 (a race). Intuitively, I also believe that races receive more Kudos in general. <a href="https://imbalanced-learn.org/stable/references/generated/imblearn.over_sampling.SMOTE.html" target="_blank" rel="noopener noreferrer">SMOTE</a> was therefore used to oversample this workout type to give more predictive power to this feature and it was later found that this reduced the RMSE.</p></li><li><p>By looking at time distribution between activities, it was found that runs that are quickly followed in succession by other runs tend to receive less kudos than runs that were the only activity that day. To add to this, the longest activity of the day tends to receive more kudos than the other runs that day.</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="preprocessing">Preprocessing<a class="hash-link" href="#preprocessing" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="train-test-and-cross-validation">Train, Test, and Cross-Validation<a class="hash-link" href="#train-test-and-cross-validation" title="Direct link to heading">​</a></h3><p>I first needed to split my dataset into a train and test set. I used an 80/20 split and as my data contained dates, I just used the most recent 20% of data as the test set. I did not want to randomly shuffle the dataset as I created some time-based features.</p><p>It is extremely important to have a good cross-validation scheme in which validation data is representative of training and real-world data, as it makes the model you build highly generalizable. Now, because I only had a small number of training examples, it would be prohibitive to have both validation and test sets. Cross-validation was therefore used on the training set to simulate a validation set.</p><p>I split the training set into 5 folds using Sklearn’s <a href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.StratifiedKFold.html" target="_blank" rel="noopener noreferrer">StratifiedKFold</a>, where <a href="https://www.statology.org/sturges-rule/" target="_blank" rel="noopener noreferrer">Sturge’s rule</a> was used to calculate the appropriate number of bins.</p><div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">/src/create_folds.py</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">create_folds</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># create a new col kfold and fill with -1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;kfold&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># randomize the rows of the data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sample</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">frac</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reset_index</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">drop</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Sturge&#x27;s rule to calc bins</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    num_bins </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">floor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">log2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># bin targets</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">loc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;bins&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cut</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;kudos_count&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> bins</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">num_bins</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> labels</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># initiate kfold class</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kf </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> model_selection</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">StratifiedKFold</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n_splits</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># fill the new kfold col</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> v_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">enumerate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">X</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bins</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">values</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">loc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">v_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;kfold&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># drop bins col</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">drop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;bins&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> axis</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># return df with folds</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> data</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Using this cross-validation scheme I was able to confidently compare different models to select the most promising models without worrying about overfitting the validation sets. This scheme was also used to tune the hyperparameters of the promising models (the folds were reshuffled before hyperparameter tuning though). It is worth noting that the only time the model was evaluated on the test set was right at the end of the project when I wanted to get a real gauge of the true performance.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="missing-values">Missing Values<a class="hash-link" href="#missing-values" title="Direct link to heading">​</a></h3><p>There was not a huge amount of missing values in the dataset, and most of the missing values came from features that are fairly new to Strava/features I didn&#x27;t always use. For example, the workout_type feature didn&#x27;t always have a ‘race’ option (which turned out to have a lot of predicting power!). Before imputing missing values, it&#x27;s always really important to first investigate missing values and try to find out if there is a reason why they are missing, it might be important!</p><p>After some inspection, I manually entered some missing values for workout_type as I believed this to be very important and some older data didn’t have labels. I chose to manually enter the values as any simple imputation technique would&#x27;ve assigned all the missing values to the default Strava category of ‘easy run’. A KNN imputer was also considered but there weren&#x27;t many unlabeled data points so manual entry was quicker.</p><p>A heuristic function was also used to fill in activities with titles that contain race positions e.g. 10th or 1st, as these activities were obviously races. This was done because races seemed to always have a big influence on Kudos.</p><p>The general imputation scheme used on the whole dataset was:</p><ul><li><p>Any missing values in a categorical feature were just assigned a new category ‘NONE’ — this seems to work well most of the time when dealing with missing categories.</p></li><li><p>All missing values in numeric features were imputed using the median strategy (mean was also tried but median worked better).</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="other-preprocessing">Other Preprocessing<a class="hash-link" href="#other-preprocessing" title="Direct link to heading">​</a></h3><p>Other data preparation steps included: dropping activities that weren&#x27;t runs, dropping activities that had no Kudos (mostly because run would&#x27;ve been on private and then switched to public), and formatting DateTime information.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="feature-engineering">Feature Engineering<a class="hash-link" href="#feature-engineering" title="Direct link to heading">​</a></h2><p>Feature engineering is one of the most crucial parts of building a good machine learning model. If we have useful features, the model will perform better.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="time-based-features">Time-Based Features<a class="hash-link" href="#time-based-features" title="Direct link to heading">​</a></h3><p>We have date and time data for each activity so we can easily make some trivial time-based features. Some of these features include year, week of the year, month, day of the week, time of day, weekend, etc.</p><p>From experience, I also know that the more activities I post on Strava a day the fewer kudos I tend to receive so I can try to incorporate this into a few features too. The features I made to encapsulate this:</p><ul><li>max_run (binary) — is the activity the longest in distance of that day?</li><li>run_per_day (ordinal) — how many total activities were done that day.</li></ul><p>I am from the U.K. but I am currently studying in Boise, Idaho so the majority of my friends/followers are from the U.K. To try to account for this, I made a binary feature ‘is_uk_awake’ that checks if the U.K. is awake when that activity was uploaded. I generally find that posting an activity outside of this time window results in fewer kudos.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="other-features">Other Features<a class="hash-link" href="#other-features" title="Direct link to heading">​</a></h3><ul><li><p>Runs that are left with default names such as ‘Afternoon Run’ tend to get less interaction than runs that have custom names. A binary feature was thus created to check if the run was named or not.</p></li><li><p>I’ve always had an intuition that runs with really nice aesthetic GPS traces tend to receive more attention than runs that don&#x27;t. To try to encapsulate this into a feature I used the runs GPS trace to workout the area enclosed by the run loop (an out and back run will return a value of 0). My idea is that bigger loops get more Kudos than smaller loops or out and back runs.</p></li><li><p>Some other features were added and can be found in my code on Github.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="feature-encoding">Feature Encoding<a class="hash-link" href="#feature-encoding" title="Direct link to heading">​</a></h3><p>One-hot-encoding was used to encode categorical features and ordinal encoding was used to encode ordinal features (categorical features where the order means something).</p><p>The workout-type feature seemed to struggle with predictive power even though I know it is a very helpful and correlated feature, it might have something to do with the uneven distribution of categories. So to help it out I used target encodings. We need to be very careful here though as this might overfit the model. Target encoding is a technique in which you map each category in a given feature to its mean target value, but this needs to always be done in a cross-validated manner!</p><div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">/src/target_encoding.py</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mean_target_encoding</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># list categorical columns</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cat_cols </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;workout_type&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;is_named&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># we label encode all the features</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> col </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> cat_cols</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># initialise label encoder</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lbl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> preprocessing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">LabelEncoder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># fit label encoder</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lbl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">col</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># transform all of the data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">loc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> col</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> lbl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">transform</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">col</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># a list to store 5 validation dataframes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    encoded_dfs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># loop over every fold</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> fold </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># get training and validation data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        df_train </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">kfold </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> fold</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reset_index</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">drop</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        df_valid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">kfold </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> fold</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reset_index</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">drop</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># for all cat columns</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> column </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> cat_cols</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># create dict of category:mean target</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mapping_dict </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df_train</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">groupby</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">column</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;kudos_count&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mean</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># column_enc is the new column we have with mean encodings</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            df_valid</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">loc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> column </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;_enc&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df_valid</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">column</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mapping_dict</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># append to our list of encoded validation dfs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        encoded_dfs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df_valid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># create full dataframe again and return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    encoded_df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">encoded_dfs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> axis</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> encoded_df</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="feature-scaling">Feature Scaling<a class="hash-link" href="#feature-scaling" title="Direct link to heading">​</a></h3><p>Finally, we need to consider scaling. As a rule of thumb, when we use a model that computes distance like K.N.N or assumes normality like linear regression, we need to scale our numeric features. Typically, we use either <a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.MinMaxScaler.html" target="_blank" rel="noopener noreferrer">min-max scaling</a> or <a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.StandardScaler.html" target="_blank" rel="noopener noreferrer">standardization</a> and to figure out which to use we just have to try both and see which results in the best performance. Tree-based models, however, are not distance-based and can handle varying ranges of features, and hence scaling is not required.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="modeling">Modeling<a class="hash-link" href="#modeling" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="initial-model-selection">Initial Model Selection<a class="hash-link" href="#initial-model-selection" title="Direct link to heading">​</a></h3><p>In this step, I built a few different candidate models and compared different metrics to determine which was the best model for deployment. Model performances and features used were saved in a CSV file to help keep track of which model was performing the best. It is very important when comparing models to train and evaluate in a cross-validated manner!</p><p>The training script I used is shown below (note: some things were removed to declutter, e.g. target encodings, etc.).</p><div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">/src/train.py</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fold</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> scale_features</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># read training data with folds</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">STRAVA_TRAIN_KFOLD_PATH</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># list all features</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    num_cols </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;distance&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;average_speed_mpk&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;suffer_score&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cat_cols </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;max_run&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;workout_type&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># all cols are features except for target and kfold</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    features </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> num_cols </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> cat_cols</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># fill cat column NaN values with NONE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> col </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> cat_cols</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">loc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> col</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">col</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">astype</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fillna</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;NONE&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># training data is where kfold is not equal to fold</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    df_train </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">kfold </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> fold</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reset_index</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">drop</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y_train </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df_train</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">kudos_count</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">values</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># validation data is where kfold = fold</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    df_valid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">kfold </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> fold</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reset_index</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">drop</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y_valid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df_valid</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">kudos_count</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">values</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># pipelines for model transformation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> scale_features</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        num_pipeline </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Pipeline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;imputer&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> impute</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SimpleImputer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">strategy</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;median&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;std_scaler&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> preprocessing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">StandardScaler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        num_pipeline </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Pipeline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;imputer&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> impute</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SimpleImputer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">strategy</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;median&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cat_pipeline </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Pipeline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;cat&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> preprocessing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OneHotEncoder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">handle_unknown</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;ignore&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># transforms columns and drops columns not specified</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x_train_num </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> num_pipeline</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fit_transform</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df_train</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">num_cols</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x_train_cat </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cat_pipeline</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fit_transform</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df_train</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">cat_cols</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x_valid_num </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> num_pipeline</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">transform</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df_valid</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">num_cols</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x_valid_cat </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cat_pipeline</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">transform</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df_valid</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">cat_cols</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># join numeric data and categorical data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x_train </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> hstack</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x_train_num</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x_train_cat</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">format</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;csr&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x_valid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> hstack</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x_valid_num</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x_valid_cat</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">format</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;csr&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># initialize model</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    model </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> model_dispatcher</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">models</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># fit model on training data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y_train</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># predict on validation data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    valid_preds </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x_valid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># get rmse, and mape</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rmse </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> metrics</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mean_squared_error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y_valid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> valid_preds</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> squared</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    max_error </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> metrics</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">max_error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y_valid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> valid_preds</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Fold = </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">fold</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">, rmse = </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">rmse</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">, max error = </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">max_error</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">x_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x_valid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y_valid</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> rmse</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Some shortlisted models that performed well were: <a href="https://xgboost.readthedocs.io/en/latest/python/python_api.html" target="_blank" rel="noopener noreferrer">XGBoost</a>, <a href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.Lasso.html" target="_blank" rel="noopener noreferrer">Lasso</a>, and <a href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestRegressor.html" target="_blank" rel="noopener noreferrer">Random Forest</a>. These models were then taken forward to the feature selection stage.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="feature-selection">Feature Selection<a class="hash-link" href="#feature-selection" title="Direct link to heading">​</a></h3><p>Feature selection was then performed to help reduce the dimensionality of the dataset with the hope that this creates a more generalizable model, we&#x27;ve all heard of the <a href="https://towardsdatascience.com/the-curse-of-dimensionality-50dc6e49aa1e" target="_blank" rel="noopener noreferrer">curse of dimensionality</a>.</p><p>Different feature selection techniques were used for the different models. For example, we did not need to do much selection for the Lasso model. When trying to minimize the cost function, Lasso regression will automatically select those features that are useful, discarding the useless or redundant features. Therefore, all we needed to do was remove features with coefficients equal to zero.</p><p>With the tree-based models, the final methodology used a combination of <a href="https://towardsdatascience.com/a-novel-approach-to-feature-importance-shapley-additive-explanations-d18af30fc21b" target="_blank" rel="noopener noreferrer">Shapley values</a> and the built-in feature importance values. Although, care needs to be taken when looking at the feature importance from tree-based models which you can read more about it <a href="https://towardsdatascience.com/be-careful-when-interpreting-your-features-importance-in-xgboost-6e16132588e7" target="_blank" rel="noopener noreferrer">here</a>.</p><p>PCA was also trialed to help combat the dimensionality but it did not improve the model performance or generalizability. One reason might be that the feature space was only reduced by 2 when accounting for 90% of the variance.</p><p>The final features chosen were: distance, average speed, max run (was the run the longest run of the day), workout type (+target encodings), total elevation gain, moving time, suffer score, run per day (number of runs that day), max speed, run area (area enclosed by GPS trace), and UK awake (was the UK awake when activity was posted?).</p><p><img loading="lazy" alt="alt" src="/assets/images/feature_imp-d45c45f8d4c839d97ccb79512f21cfe5.png" width="1400" height="1073" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="hyperparameter-tuning">Hyperparameter Tuning<a class="hash-link" href="#hyperparameter-tuning" title="Direct link to heading">​</a></h3><p><a href="https://optuna.org/" target="_blank" rel="noopener noreferrer">Optuna</a> was used to tune all three shortlisted models, an open-source framework that is very easy to use and incredibly good. In particular, the Tree-structured Parzen Estimator (TPE) was used to sample the parameter space, which uses Bayesian reasoning to construct a surrogate model and can select the next hyperparameters using <a href="http://krasserm.github.io/2018/03/21/bayesian-optimization/#:~:text=Expected%20improvement%20is%20defined%20as,if%20%CF%83(x)%3D0" target="_blank" rel="noopener noreferrer">Expected Improvement</a>. A good tutorial on hyperparameter tuning with Optuna can be found <a href="https://medium.com/subex-ai-labs/efficient-hyperparameter-optimization-for-xgboost-model-using-optuna-3ee9a02566b1" target="_blank" rel="noopener noreferrer">here</a>.</p><p>The code I used to tune my XGB model is shown below.</p><div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">/src/tune_hyperparameters/py</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">objective</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">trial</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n_jobs</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> random_state</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">42</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># read in the data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;input/data_train.csv&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># prepare data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> process</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">loc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;kudos_count&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">kudos_count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># stratisfied kfold</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> create_folds</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># define parameter search space for XGB</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    params </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;tree_method&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;gpu_hist&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;verbosity&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 0 (silent) - 3 (debug)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;objective&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;reg:squarederror&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;n_estimators&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> trial</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">suggest_int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;n_estimators&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;max_depth&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> trial</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">suggest_int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;max_depth&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;learning_rate&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> trial</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">suggest_loguniform</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;learning_rate&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.005</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.05</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;colsample_bytree&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> trial</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">suggest_loguniform</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;colsample_bytree&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.6</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;subsample&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> trial</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">suggest_loguniform</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;subsample&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;alpha&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> trial</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">suggest_loguniform</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;alpha&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.01</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10.0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;lambda&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> trial</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">suggest_loguniform</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;lambda&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1e-8</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10.0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;gamma&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> trial</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">suggest_loguniform</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;lambda&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1e-8</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10.0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;min_child_weight&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> trial</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">suggest_loguniform</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;min_child_weight&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;seed&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> random_state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;n_jobs&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> n_jobs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># add pruning callback which prunes unpromising trials</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pruning_callback </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> XGBoostPruningCallback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">trial</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;validation_0-rmse&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># scores for each fold</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    scores </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># everything is a feature apart from the target and kfold col</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    features </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">f </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> f </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">columns </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> f </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;kudos_count&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;kfold&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># loop over each fold</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> fold </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># training data is where kfold is not equal to fold</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        x_train </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">kfold </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> fold</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reset_index</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">drop</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        y_train </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> x_train</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">kudos_count</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">values</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        x_train </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> x_train</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">features</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># validation data is where kfold = fold</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        x_valid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">kfold </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> fold</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reset_index</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">drop</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        y_valid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> x_valid</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">kudos_count</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">values</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        x_valid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> x_valid</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">features</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># initialize model and fit on data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        model </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> xgb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">XGBRegressor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">**</span><span class="token plain">params</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            x_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            y_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            eval_set</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x_valid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y_valid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            early_stopping_rounds</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            verbose</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            callbacks</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">pruning_callback</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># predict and score model on validation set</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        preds </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x_valid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        scores</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mean_squared_error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y_valid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> preds</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> squared</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># return average rmse across the 5 folds</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    score </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scores</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scores</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> score</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;__main__&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># initialize Optuna TPE sampler</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sampler </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TPESampler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># create study in which we minimize rmse</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    study </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> create_study</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">direction</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;minimize&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sampler</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">sampler</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># optimize hyperparams on XGB model</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    study</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">optimize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">objective</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n_trials</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># display params</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    best </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> study</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">best_params</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> best</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">items</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">key</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation format-spec">&gt;20s</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> : </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">value</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation string" style="color:#e3116c">&#x27;best objective value&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation format-spec">&gt;20s</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> : </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">study</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">best_value</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># save best hyperparams</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;models/production/xgb_params.pickle&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;wb&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pickle</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dump</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">best</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The optimization history plot below shows how quickly the TPE sampler converges to the optimal hyperparameters. The two other plots show the importance of each hyperparameter and the high-dimensional parameter relationships, respectively.</p><p><img loading="lazy" alt="alt" src="/assets/images/hyper1-b471ae01e956b0b5edf9ef62af1c7f68.png" width="905" height="450" class="img_ev3q">
<img loading="lazy" alt="alt" src="/assets/images/hyper2-5a3acfa811b57f9961b030cb638eeafe.png" width="905" height="450" class="img_ev3q">
<img loading="lazy" alt="alt" src="/assets/images/hyper3-9ba5015b649a43245652f9d6513ba167.png" width="905" height="450" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="model-selection">Model Selection<a class="hash-link" href="#model-selection" title="Direct link to heading">​</a></h3><p>After performing the hyperparameter tuning, it was found that the XGB model consistently outperformed the other two shortlisted models. As seen in the table below, the average RMSE over 5 folds was lower. It was also found that the variance of the error was lower. From this, I concluded that with the data I had, the XGB model was more likely to generalize better to unseen data.</p><table><thead><tr><th>Model</th><th>Fold 1</th><th>Fold 2</th><th>Fold 3</th><th>Fold 4</th><th>Fold 5</th><th>Mean</th><th>Variance</th></tr></thead><tbody><tr><td>XGBRegressor</td><td>9.12</td><td>9.47</td><td>9.33</td><td>9.59</td><td>9.54</td><td>9.41</td><td>0.036</td></tr><tr><td>RandomForestRegressor</td><td>10.51</td><td>10.94</td><td>11.09</td><td>11.16</td><td>10.75</td><td>10.89</td><td>0.070</td></tr><tr><td>Lasso</td><td>9.78</td><td>9.99</td><td>10.93</td><td>11.04</td><td>10.96</td><td>10.54</td><td>0.36</td></tr></tbody></table><p>The final XGB model was then trained on the <strong>whole</strong> training dataset using the hyperparameters found earlier.</p><p>It was comforting to see that when these three models were used to predict on the test dataset, the XGB model outperformed both other models. Disclaimer: this was (and needs to be) done after model selection, you don&#x27;t want to overfit the test set! The test set scores were 9.78, 11.83, and 10.68 for XGB, RF, and Lasso, respectively.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="deployment">Deployment<a class="hash-link" href="#deployment" title="Direct link to heading">​</a></h2><p>The model, along with some other features, was deployed using Streamlit and Heroku. Tutorials on Streamlit and Heroku can be found <a href="https://towardsdatascience.com/build-your-first-interactive-data-science-web-app-with-streamlit-d4892cbe4792" target="_blank" rel="noopener noreferrer">here</a> and <a href="https://towardsdatascience.com/a-quick-tutorial-on-how-to-deploy-your-streamlit-app-to-heroku-874e1250dadd" target="_blank" rel="noopener noreferrer">here</a>. An interface was built in which you could predict on my real-time Strava data, explore the model explainability, and explore the dataset. The app can be found <a href="http://strava-kudos.herokuapp.com/" target="_blank" rel="noopener noreferrer">here</a> (it may take a minute or so to boot up, apologies).</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="model-explainability">Model Explainability<a class="hash-link" href="#model-explainability" title="Direct link to heading">​</a></h2><p>The final part of this project was investigating the model to try and see, in general, what attributes caused activities to get more/fewer kudos.</p><p>Interpreting XGBoost models is a notoriously hard task but with the combination of a solid theoretical backing and a fast practical algorithm, SHAP values are an incredibly powerful tool for confidently interpreting tree-based models.</p><p>The mean SHAP values for the final features can be seen below.
<img loading="lazy" alt="alt" src="/assets/images/shap-e3d5fc7ad6d6e755a1c41d40e763a048.png" width="1400" height="1073" class="img_ev3q"></p><p>We can see that the distance feature is actually the most important, followed by the max_run feature (which is great to see as this is a feature I created!). Because SHAP gives us individualized explanations for every activity, we can do more than just make a bar chart. We can see how each feature affects the final Kudos value:
<img loading="lazy" alt="alt" src="/assets/images/shap2-d895628f3c0622c8454aad37103920fe.png" width="1400" height="1093" class="img_ev3q"></p><p>The color in this plot represents the feature value — red indicating high and blue indicating low. So we can see that longer faster runs get more Kudos. More effort (higher heart rate and suffer score) also results in higher Kudos. On the other hand, easy runs get fewer Kudos than workouts, long runs, and races.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="closing-thoughts">Closing Thoughts<a class="hash-link" href="#closing-thoughts" title="Direct link to heading">​</a></h2><p>So there we go, a unique and successful data science project has been finished. Well, kind of… just because we have built a good model doesn&#x27;t mean the model is always going to be a good one, it might drift.</p><p>Model drift refers to the degradation of model performance due to changes in data and relationships between input and output variables. So its important to check in every and then to see if the model is still performing at an adequate level. Maybe this is a topic for a future blog though.</p><p>Thanks for reading and I hope you enjoyed it. If you have any comments or questions please feel free to reach out.</p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_u0Nl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/python">Python</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/regression">Regression</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/scikit-learn">Scikit-Learn</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/optuna">Optuna</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/xg-boost">XGBoost</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/Churn-Prediction"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Building Interpretable Models on Imbalanced Data</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/Recipe-Recommendation"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Building a Recipe Recommendation System</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#data-collection" class="table-of-contents__link toc-highlight">Data Collection</a></li><li><a href="#exploratory-data-analysis-eda" class="table-of-contents__link toc-highlight">Exploratory Data Analysis (EDA)</a></li><li><a href="#preprocessing" class="table-of-contents__link toc-highlight">Preprocessing</a><ul><li><a href="#train-test-and-cross-validation" class="table-of-contents__link toc-highlight">Train, Test, and Cross-Validation</a></li><li><a href="#missing-values" class="table-of-contents__link toc-highlight">Missing Values</a></li><li><a href="#other-preprocessing" class="table-of-contents__link toc-highlight">Other Preprocessing</a></li></ul></li><li><a href="#feature-engineering" class="table-of-contents__link toc-highlight">Feature Engineering</a><ul><li><a href="#time-based-features" class="table-of-contents__link toc-highlight">Time-Based Features</a></li><li><a href="#other-features" class="table-of-contents__link toc-highlight">Other Features</a></li><li><a href="#feature-encoding" class="table-of-contents__link toc-highlight">Feature Encoding</a></li><li><a href="#feature-scaling" class="table-of-contents__link toc-highlight">Feature Scaling</a></li></ul></li><li><a href="#modeling" class="table-of-contents__link toc-highlight">Modeling</a><ul><li><a href="#initial-model-selection" class="table-of-contents__link toc-highlight">Initial Model Selection</a></li><li><a href="#feature-selection" class="table-of-contents__link toc-highlight">Feature Selection</a></li><li><a href="#hyperparameter-tuning" class="table-of-contents__link toc-highlight">Hyperparameter Tuning</a></li><li><a href="#model-selection" class="table-of-contents__link toc-highlight">Model Selection</a></li></ul></li><li><a href="#deployment" class="table-of-contents__link toc-highlight">Deployment</a></li><li><a href="#model-explainability" class="table-of-contents__link toc-highlight">Model Explainability</a></li><li><a href="#closing-thoughts" class="table-of-contents__link toc-highlight">Closing Thoughts</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://linkedin.com/in/jackmleitch" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn</a></li><li class="footer__item"><a href="https://twitter.com/jackmleitch" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://medium.com/@jackmleitch" target="_blank" rel="noopener noreferrer" class="footer__link-item">Medium</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/jackmleitch" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Jack Leitch. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.e098bd35.js"></script>
<script src="/assets/js/main.8cf1aa75.js"></script>
</body>
</html>